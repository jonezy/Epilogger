@using Epilogger.Web;
@using Epilogger.Web.Models;
@model Epilogger.Web.Models.AllStatsViewModel

@{
    ViewBag.Title = Model.Name + " - Stats (Page " + (Model.CurrentPageIndex + 1) + ") | Epilogger";
    Layout = "~/Views/Shared/_InteriorLayout.cshtml";
}

@*New event menu*@
@Html.Partial("Menu", Model.ToolbarViewModel)
<div class="spacer"></div>

<div id="reportContainer">
    <strong>While Epilogger is in Alpha, please enjoy just some of the statistics that we can provide about your event.</strong>
	<div id="header">
		<div class="two-thirds postit">
			<h1>Report: @Model.Name</h1>
			<div class="eventHashTags">
                @{
                    try
                    {
                        string[] SearchT = Model.SearchTerms.Split(new string[] { " OR " }, StringSplitOptions.None);
                        string SearchTerms = "";

                        foreach (string s in SearchT)
                        {
                            SearchTerms += s + ", ";
                        }
        
                    @Html.Raw("<strong>" + SearchTerms.Substring(0, (SearchTerms.Length - 2)) + "</strong>")
                    }
                    catch
                    {
                    <strong>@Model.SearchTerms</strong>
                    }
                }
            </div>
			
			<span class="spacer"></span>
			<div class="ribbon-edging">
			    <span class="ribbon">
                    @if (Model.FromDateTime != null && Model.ToDateTime != null)
                    {
                        @Html.DisplayFor(model => model.FromDateTime) @: to @Html.DisplayFor(model => model.ToDateTime)
                    }
                    else
                    {
                        @Html.DisplayFor(model => model.CollectionStartDateTime) @: to 
                        if (Model.CollectionEndDateTime < DateTime.UtcNow)
                        {
                            @: @Html.DisplayFor(model => model.CollectionEndDateTime)
                        }
                        else
                        {
                             @: @Html.DisplayFor(model => model.MyUTCNow)
                        }
                    }
				    
			    </span>
			</div>
		</div>
		
		<div class="one-third postit">
			<img src="/Public/Images/Reports/logo.png" alt="Epilogger" />
			
			<span class="spacer"></span>
			
			<div class="ribbon-edging robbin-right">
			<span class="ribbon">
				Generated by Epilogger.com
			</span>
			</div>
		</div>
	</div>
	
	
	<span class="clear"></span>
	
	
	<div id="report">
		<div class="one-third rmargin">
			<h2><span class="reportNumber">@Model.ImageCount</span> photos shared</h2>
		 	
		 	<span class="spacer clear"></span>
		 	
		 	<h3>Top Photos & Sharers</h3>
		 	
            @foreach (TopImageAndTweet Img in Model.TopImages)
            {
                <div class="photo-item">
				    @*<img src="@Img.Image.Fullsize" alt ="" />*@
                    <a href="@Img.Image.Fullsize" rel="EPLPhoto[reportphotos]" photoid="@Img.Image.ID" title="" id="@Img.Image.ID">
                        <img src="@Img.Image.Fullsize" border="0" alt="" />
                    </a>
                    @if (Img.Tweet != null)
                    {
				        <a href="http://www.twitter.com/@Img.Tweet.FromUserScreenName" target="_blank"><font class="lightgray">@@</font> @Img.Tweet.FromUserScreenName</a><br/>
				        <em class="lightgray">@Html.Raw(Img.Tweet.TextAsHTML)</em>	
                    }
		 	    </div>
            }
		</div>
		
		<div class="one-third rmargin">
			<h2><span class="reportNumber">@Model.ExternalLinkCount</span> outgoing links</h2>
		 	
		 	<span class="spacer clear"></span>
		 	
		 	<h3>Link Distribution</h3>
		 	Under construction
            @*<table id="piechart-label">
                <tr>
		 		    <td style="">TMI.me <div class="colour fleft"></div></td>
		 		    <td>Co.nt.est <div class="colour fleft"></div></td>
		 		    <td>Ht.ly <div class="colour fleft"></div></td>
		 		    <td>Ow.ly <div class="colour fleft"></div></td>
		 		    <td>T.co <div class="colour fleft"></div></td>
		 		</tr>
		 		<tr>
		 		    <td><div class="colour fright"></div> Levynewsnetwork.com</td>
		 		    <td><div class="colour fright"></div> yFrog.us</td>
		 		    <td><div class="colour fright"></div> Foursquare.com</td>
		 		    <td><div class="colour fright"></div> Untappd.com</td>
		 		    <td><div class="colour fright"></div> Other</td>
                </tr>
		 	</table>
            *@
		 	
		 	<span class="spacer"></span>
		 	
		 	<h3>Top Five Shared Links</h3>
		 	<ul>
                @foreach (TopURLs TU in Model.TopLinks)
                {
                    <li>
                        <a href="@TU.FullURL" target="_blank">@TU.FullURL</a><br/>
                        <font class="lightgray"><em>@TU.countcol times</em></font>
                    </li>
                }
            </ul>
		</div>
		
		<div class="one-third">
		 	<h2><span class="reportNumber">@Model.TweetCount</span> total tweets</h2>
		 	
		 	<span class="spacer clear"></span>
		 	
		 	<h3>Top ten tweeters:</h3>	
		 	
		 	
		 	<table class="reportTables">
                @foreach (Epilogger.Web.Core.Stats.Tweeter T in Model.TopTweeters)
                {
                    <tr>
		 			    <td class="amount">@T.Total</td>
		 			    <td valign="middle" class="separator"><span class="separator"></span></td>
		 			    @*<td class="tweeter"><a href="http://www.twitter.com/@T.Name" target="_blank"><font class="lightgray">@@</font> @T.Name</a></td>*@
                        <td class="tweeter">
                            <a href="@Url.Action("Search", "Events", new { id = @Model.EventSlug, IEsearchterm = T.Name })"><font class="lightgray">@@</font> @T.Name</a>
                        </td>
		 		    </tr>
                }
		 	</table>
		 	
		 	<span class="spacer"></span>
		 	<span class="spacer"></span>
		 	
		 	<h3>Hashtag Breakdown</h3>
            Under construction
		 	@*<table class="reportTables">
		 		<tr>
		 			<td class="amount">758</td>
		 			<td class="separator"><span class="separator"></span></td>
		 			<td class="tweeter"><font class="lightgray">#</font> TOBeerFest</td>
		 		</tr>
		 		<tr>
		 			<td class="amount">480</td>
		 			<td class="separator"><span class="separator"></span></td>
		 			<td class="tweeter"><font class="lightgray">@@</font> TOBeerFestival</td>
		 		</tr>
		 		<tr>
		 			<td class="amount">69</td>
		 			<td class="separator"><span class="separator"></span></td>
		 			<td class="tweeter"><font class="lightgray">#</font> TOBeerFestival</td>
		 		</tr>
		 		<tr>
		 			<td class="amount">39</td>
		 			<td class="separator"><span class="separator"></span></td>
		 			<td class="tweeter"><font class="lightgray">#</font> BeerFestTO</td>
		 		</tr>
		 		<tr>
		 			<td class="amount">27</td>
		 			<td class="separator"><span class="separator"></span></td>
		 			<td class="tweeter"><font class="lightgray">@@</font> TOBeerFest</td>
		 		</tr>
		 		<tr>
		 			<td class="amount">4</td>
		 			<td class="separator"><span class="separator"></span></td>
		 			<td class="tweeter"><font class="lightgray">#</font> TorontoBeerFestival</td>
		 		</tr>
		 		<tr>
		 			<td class="amount">3</td>
		 			<td class="separator"><span class="separator"></span></td>
		 			<td class="tweeter"><font class="lightgray">@@</font> TorontoFestivalofBeer</td>
		 		</tr>
		 		<tr>
		 			<td class="amount">64</td>
		 			<td class="separator"><span class="separator"></span></td>
		 			<td class="tweeter"><font class="lightgray">@@</font> TOBeerFestival</td>
		 		</tr>
		 	</table>*@
		 	
		 	<span class="spacer"></span>
		 	<span class="spacer"></span>
		 	
		 	<h3>Public Foursquare Checkins</h3>
		 	<table width="100%" class="reportTables">
		 		<tr>
                    @{
                        int i = 1;
                        int MidP = Model.AllCheckIns.Count() / 2;
                    }
                    @foreach (CheckinDisplayViewModel c in Model.AllCheckIns)
                    {
                        if (i == 1)
                        {
                            @: <td width="50%">
                        }
                        if (i == MidP + 2)
                        {
                            @: </td>
                            @: <td width="50%">
                        }
                        @: <font class="lightgray">@@</font> @c.Tweet.FromUserScreenName<br/>
                        i++;
                    }
                    </td>
		 		</tr>
		 	</table>
		</div>
		
		<br class="clear"/>
	</div>
</div>

<br class="clear"/>




<script type="text/javascript" charset="utf-8">
    head.ready(function () {
        $("a[rel^='EPLPhoto']").prettyPhoto({
            theme: 'light_square',
            animation_speed: 'fast',
            overlay_gallery: false,
            changepicturecallback: function () { changeDescription(); }
        });
    });
</script>


@Html.Partial("_ExpiredEventModalScript", new ExpiredEventModalScriptViewModel { EventId = Model.ID, IsExpired = Model.IsExpired })